@model RentalFormViewModel

@{
    var title = Model.CurrentCopies.Any() ? "Edit" : "Add";
    ViewData["Title"] = $"{title} Rental";
}

<div class="card mb-7">
    <div class="card-header">
        <h3 class="card-title">@title Rental</h3>
    </div>
    <div class="card-body">
        <partial name="_SearchForm" model="new SearchFormViewModel()" />
    </div>
    <div class="card mb-5 mb-xl-8">
        <div class="card-header border-0 pt-5">
            <h3 class="card-title align-items-start flex-column">
                <span class="card-label fw-bold text-dark">Books</span>
                <span class="text-muted mt-1 fw-semibold fs-7">You can add up to @Model.MaxAllowedCopies book(s)</span>
            </h3>
        </div>
        <div class="card-body pt-5">
            <form id="CopiesForm" asp-controller="Rentals" asp-action="@(Model.Id.HasValue ? "Edit" : "Create")" method="post">
                @* IMPORTANT: Add Anti-Forgery Token for security *@
                @Html.AntiForgeryToken()

                @* IMPORTANT: Add hidden input for Id for Edit scenarios *@
                <input type="hidden" asp-for="Id" />
                <input type="hidden" asp-for="SubscriberId" />

                @foreach (var copy in Model.CurrentCopies)
                {
                    <partial name="_CopyDetails" model="copy" />
                }

                <button type="submit" class="btn btn-primary d-none">
                    <span class="indicator-label">
                        Save
                    </span>
                    <span class="indicator-progress">
                        Please wait... <span class="spinner-border spinner-border-sm align-middle ms-2"></span>
                    </span>
                </button>
            </form>
        </div>
    </div>
</div>
@section Scripts
{
    <partial name="_ValidationScriptsPartial" />
    <script>
        // Ensure maxAllowedCopies is correctly set from your C# model
        var maxAllowedCopies = 3 /* @Model.MaxAllowedCopies */;
    </script>
    <script src="~/js/rental-form.js" asp-append-version="true"></script>
}