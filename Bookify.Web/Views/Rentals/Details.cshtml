@model RentalViewModel

@{
    ViewData["Title"] = "Rental Details";
}

<div class="alert bg-light-primary border border-primary border-3 border-dashed d-flex justify-content-between align-items-center w-100 p-2 mb-3">
    <div class="d-flex align-items-center">
        <div class="symbol symbol-40px me-4">
            <div class="symbol-label fs-2 fw-semibold text-success">
                <!--begin::Svg Icon | path: icons/duotune/general/gen002.svg-->
                <span class="svg-icon svg-icon-2 svg-icon-primary">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path opacity="0.3" d="M20 15H4C2.9 15 2 14.1 2 13V7C2 6.4 2.4 6 3 6H21C21.6 6 22 6.4 22 7V13C22 14.1 21.1 15 20 15ZM13 12H11C10.5 12 10 12.4 10 13V16C10 16.5 10.4 17 11 17H13C13.6 17 14 16.6 14 16V13C14 12.4 13.6 12 13 12Z" fill="currentColor" />
                        <path d="M14 6V5H10V6H8V5C8 3.9 8.9 3 10 3H14C15.1 3 16 3.9 16 5V6H14ZM20 15H14V16C14 16.6 13.5 17 13 17H11C10.5 17 10 16.6 10 16V15H4C3.6 15 3.3 14.9 3 14.7V18C3 19.1 3.9 20 5 20H19C20.1 20 21 19.1 21 18V14.7C20.7 14.9 20.4 15 20 15Z" fill="currentColor" />
                    </svg>
                </span>
                <!--end::Svg Icon-->
            </div>
        </div>
        <!--begin::Content-->
        <div class="d-flex flex-column pe-0 pe-sm-2">
            <h5>Rental Details</h5>
        </div>
        <!--end::Content-->
    </div>
    <div class="d-flex align-items-center">
        @if (Model.CreatedOn.Date == DateTime.Today)
        {
            <a class="btn btn-sm btn-primary" asp-action="Edit" asp-route-id="@Model.Id">
                <i class="bi bi-plus-square-dotted"></i>
                Edit
            </a>
        }
        else if(Model.RentalCopies.Any(c => !c.ReturnDate.HasValue))
        {
            <a class="btn btn-sm btn-primary" asp-action="Return" asp-route-id="@Model.Id">
                <i class="bi bi-plus-square-dotted"></i>
                Return
            </a>
}
    </div>
</div>

<div class="card shadow-lg pt-4 mb-6 mb-xl-9">
    <!--begin::Card header-->
    <div class="card-header border-0 pt-5">
        <h3 class="card-title align-items-start flex-column">
            <span class="card-label fw-bold fs-3 mb-1">Books</span>
        </h3>
    </div>
    <!--end::Card header-->
    <!--begin::Card body-->
    <div class="card-body pt-0 pb-5">
        <div class="table-responsive">

            <div class="card shadow-sm border-0">
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle">
                            <!-- Table Head -->
                            <thead class="table-light">
                                <tr class="text-muted text-sm">
                                    <th class="ps-4 rounded-start" style="min-width: 200px;">Book</th>
                                    <th style="min-width: 120px;">Start Date</th>
                                    <th style="min-width: 120px;">End Date</th>
                                    <th style="min-width: 140px;">Total Delay</th>
                                    <th style="min-width: 140px;">Return Date</th>
                                    <th class="pe-4 text-end rounded-end" style="min-width: 140px;">Extend Date</th>
                                </tr>
                            </thead>

                            <!-- Table Body -->
                            <tbody class="border-top-0 text-sm">
                                @foreach (var copy in Model.RentalCopies)
                                {
                                    <tr>
                                        <!-- Book Column -->
                                        <td class="ps-4">
                                            <div class="d-flex align-items-center">
                                                <div class="flex-shrink-0 me-3">
                                                    <img src="@copy.BookCopy?.BookThumbnailUrl"
                                                         class="rounded-1 shadow-sm"
                                                         style="width: 50px; height: 70px; object-fit: cover;"
                                                         alt="@copy.BookCopy?.BookTitle">
                                                </div>
                                                <div class="flex-grow-1">
                                                    <h6 class="mb-1 fw-bold text-sm text-truncate" style="max-width:100px">@copy.BookCopy?.BookTitle</h6>
                                                    <small class="text-muted">Edition #@copy.BookCopy?.EditionNumber</small>
                                                </div>
                                            </div>
                                        </td>

                                        <!-- Dates Columns -->
                                        <td>
                                            <span class="text-dark text-sm">@copy.RentalDate.ToString("d MMM, yyyy")</span>
                                        </td>
                                        <td>
                                            <span class="text-dark text-sm">@copy.EndDate.ToString("d MMM, yyyy")</span>
                                        </td>
                                        <td class="@(copy.DelayInDays > 0 ? "text-danger fw-bold" : "text-dark")">
                                            @copy.DelayInDays Day(s)
                                        </td>
                                        <td>
                                            @if (copy.ReturnDate.HasValue)
                                            {
                                                <span class="text-dark">@copy.ReturnDate.Value.ToString("d MMM, yyyy")</span>
                                            }
                                            else
                                            {
                                                <span class="badge bg-light-warning text-warning">Pending</span>
                                            }
                                        </td>
                                        <td class="text-end pe-4">
                                            @if (copy.ExtendedOn.HasValue)
                                            {
                                                <span class="text-dark">@copy.ExtendedOn.Value.ToString("d MMM, yyyy")</span>
                                            }
                                            else
                                            {
                                                <span class="badge bg-light-secondary text-secondary">Not Extended</span>
                                            }
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--end::Card body-->
</div>